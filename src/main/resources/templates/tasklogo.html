<!doctype html>
<html class="no-js h-100" lang="en" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>补充logo信息</title>
    <meta name="description" content="A high-quality &amp; free Bootstrap admin dashboard template pack that comes with lots of templates and components.">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="https://use.fontawesome.com/releases/v5.0.6/css/all.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="stylesheet" id="main-stylesheet" data-version="1.1.0" href="/styles/shards-dashboards.1.1.0.min.css">
    <link rel="stylesheet" href="/styles/extras.1.1.0.min.css">
    <script async defer src="https://buttons.github.io/buttons.js"></script>
      <link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon">
      <link rel="icon" href="/images/favicon.ico">
  </head>
  <body class="h-100" id="myp">

  <div class="container-fluid">
      <div class="row">
          <!-- Main Sidebar -->
          <aside class="main-sidebar col-12 col-md-3 col-lg-2 px-0">
              <div class="main-navbar">
                  <nav class="navbar align-items-stretch navbar-light bg-white flex-md-nowrap border-bottom p-0">
                      <a class="navbar-brand w-100 mr-0" href="#" style="line-height: 25px;">
                          <div class="d-table m-auto">
                              <img id="main-logo" class="d-inline-block align-top mr-1" style="max-width: 25px;" src="/images/favicon.ico" alt="Shards Dashboard">
                              <span class="d-none d-md-inline ml-1">零件邦之传奇</span>
                          </div>
                      </a>

                  </nav>
              </div>
              <form action="#" class="main-sidebar__search w-100 border-right d-sm-flex d-md-none d-lg-none">
                  <div class="input-group input-group-seamless ml-3">
                      <div class="input-group-prepend">
                          <div class="input-group-text">
                              <i class="fas fa-search"></i>
                          </div>
                      </div>
                      <input class="navbar-search form-control" type="text" placeholder="Search for something..." aria-label="Search"> </div>
              </form>
              <div class="nav-wrapper">
                  <ul class="nav flex-column">
                      <li class="nav-item">
                          <a class="nav-link active" href="/system/index">
                              <i class="material-icons">view_module</i>
                              <span>首页</span>
                          </a>
                      </li>
                      <li class="nav-item">
                          <a class="nav-link " href="/system/company">
                              <i class="material-icons">vertical_split</i>
                              <span>补全公司信息</span>
                          </a>
                      </li>
                      <li class="nav-item">
                          <a class="nav-link" href="/system/filelib">
                              <i class="material-icons">vertical_split</i>
                              <span>样本提交列表 <span class="badge badge-pill badge-danger" id="yb"></span></span>
                          </a>
                      </li>
                      <li class="nav-item">
                          <a class="nav-link " href="/system/fk">
                              <i class="material-icons">vertical_split</i>
                              <span>反馈信息 <span class="badge badge-pill badge-danger" id="fk"></span></span>
                          </a>
                      </li>
                      <li class="nav-item">
                          <a class="nav-link " href="/system/fk">
                              <i class="material-icons">vertical_split</i>
                              <span>反馈信息</span>
                          </a>
                      </li>

                      <li class="nav-item">
                          <a class="nav-link" href="/system/fiveclass">
                              <i class="material-icons">vertical_split</i>
                              <span>产品综合信息</span>
                          </a>
                      </li>
                      <li class="nav-item">
                          <a class="nav-link " href="/system/userdata">
                              <i class="material-icons">vertical_split</i>
                              <span>统计数据</span>
                          </a>
                      </li>
                  </ul>
              </div>
          </aside>
        <!-- End Main Sidebar -->
        <main class="main-content col-lg-10 col-md-9 col-sm-12 p-0 offset-lg-2 offset-md-3">
          <div class="main-navbar sticky-top bg-white">
            <!-- Main Navbar -->
            <nav class="navbar align-items-stretch navbar-light flex-md-nowrap p-0">
              <form action="#" class="main-navbar__search w-100 d-none d-md-flex d-lg-flex">
                <div class="input-group input-group-seamless ml-3">
                  <div class="input-group-prepend">
                    <div class="input-group-text">
                      <i class="fas fa-search"></i>
                    </div>
                  </div>
                  <input class="navbar-search form-control" type="text" placeholder="Search for something..." aria-label="Search"> </div>
              </form>
              <ul class="navbar-nav border-left flex-row ">
                <li class="nav-item border-right dropdown notifications">
                  <a class="nav-link nav-link-icon text-center" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <div class="nav-link-icon__wrapper">
                      <i class="material-icons">&#xE7F4;</i>
                      <span class="badge badge-pill badge-danger">2</span>
                    </div>
                  </a>
                  <div class="dropdown-menu dropdown-menu-small" aria-labelledby="dropdownMenuLink">
                    <a class="dropdown-item" href="#">
                      <div class="notification__icon-wrapper">
                        <div class="notification__icon">
                          <i class="material-icons">&#xE6E1;</i>
                        </div>
                      </div>
                      <div class="notification__content">
                        <span class="notification__category">Analytics</span>
                        <p>Your website’s active users count increased by
                          <span class="text-success text-semibold">28%</span> in the last week. Great job!</p>
                      </div>
                    </a>
                    <a class="dropdown-item" href="#">
                      <div class="notification__icon-wrapper">
                        <div class="notification__icon">
                          <i class="material-icons">&#xE8D1;</i>
                        </div>
                      </div>
                      <div class="notification__content">
                        <span class="notification__category">Sales</span>
                        <p>Last week your store’s sales count decreased by
                          <span class="text-danger text-semibold">5.52%</span>. It could have been worse!</p>
                      </div>
                    </a>
                    <a class="dropdown-item notification__all text-center" href="#"> View all Notifications </a>
                  </div>
                </li>
                  <li class="nav-item dropdown">
                      <a class="nav-link dropdown-toggle text-nowrap px-3" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">
                          <img class="user-avatar rounded-circle mr-2" id="userimage" src="/https://iph.href.lu/500x500?text=%E9%9B%B6%E4%BB%B6%E9%82%A6&fg=666666&bg=CCCCCC" alt="User Avatar">
                          <span class="d-none d-md-inline-block" id="username">Sierra Brooks</span>
                      </a>
                  </li>
              </ul>
              <nav class="nav">
                <a href="#" class="nav-link nav-link-icon toggle-sidebar d-md-inline d-lg-none text-center border-left" data-toggle="collapse" data-target=".header-navbar" aria-expanded="false" aria-controls="header-navbar">
                  <i class="material-icons">&#xE5D2;</i>
                </a>
              </nav>
            </nav>
          </div>
          <div class="main-content-container container-fluid px-4">
            <!-- Page Header -->
            <div class="page-header row no-gutters py-4">
              <div class="col-12 col-sm-8 text-center text-sm-left mb-0">
                <span style="font-size:.800rem; " class="text-uppercase page-subtitle" id="root"><input type="button" class="mb-2 btn btn-sm btn-outline-danger mr-1" onclick="javascript:history.go(-1)" value="上一个"></span>
                <h3 class="page-title" id="title"></h3>
              </div>
            </div>
            <!-- End Page Header -->
            <!-- Default Light Table -->
            <div class="row" style="width: 35%;float: left;margin-right: 20px;">
              <div class="col-lg-12">
                <div class="card card-small mb-4 pt-3">
                  <div class="card-header border-bottom text-center">
                    <div class="mb-3 mx-auto">
                      <img  style="width: 200px;height: 200px;" id="mylogo" src="https://iph.href.lu/500x500?text=%E9%9B%B6%E4%BB%B6%E9%82%A6&fg=666666&bg=CCCCCC" alt="User Avatar" width="110"> </div>
                    <h4 class="mb-0">LOGO</h4>
                    <input type="file" id="imgfile" style="width: 40%"  class="mb-2 btn btn-sm btn-pill btn-outline-primary mr-2" />
                  </div>
                    <button type="submit" class="btn btn-accent" onclick="update()" style="width: 100%;height: 50px;"> 保存补全信息</button>


                </div>
                  <input type="hidden" id="coreid" th:value="${id}">
                  <input type="hidden" id="mylogourl" >
                  <input type="hidden" id="level" >
              </div>

            </div>
              <div class="row" id="level5space" style="width: 63%;float: left">

              </div>
            <!-- End Default Light Table -->
          </div>


        </main>
      </div>
    </div>


    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.min.js"></script>
    <script src="https://unpkg.com/shards-ui@latest/dist/js/shards.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sharrre/2.0.1/jquery.sharrre.min.js"></script>
    <script src="/scripts/extras.1.1.0.min.js"></script>
    <script src="/scripts/shards-dashboards.1.1.0.min.js"></script>
  <script src="/scripts/jquery.cookie.min.js" type="text/javascript"></script>
  <script>
      $("#root").append("<input type=\"button\" class=\"mb-2 btn btn-sm btn-outline-danger mr-1\" onclick=\"tg('"+$("#coreid").val()+"')\" value=\"下一个\">");

      var settings = {
          "async": true,
          "crossDomain": true,
          "url": "/user/get",
          "method": "GET",
          "processData": false,
          "headers": {
              "Authorization": "Bearer " + $.cookie("ACCESS_TOKEN"),
              "cache-control": "no-cache",
              "Postman-Token": "0d83bfb4-ef46-46d6-ae5e-02b7a296a3e2"
          }
      }


      $.ajax(settings).done(function (response) {
          if(response.status!=200){
              window.location.href="/system/login";
          }else {
              if(response.data.ybcount!=0){
                  $("#yb").html(response.data.ybcount);
              }
              if(response.data.fkcount!=0) {
                  $("#fk").html(response.data.fkcount);
              }
              $("#userimage").attr("src",response.data.headportrait);
              $("#username").html(response.data.name);
          }
      });

      function init() {
          var settings = {
              "async": true,
              "crossDomain": true,
              "url": "/productclass/getByLevelCondition",
              "method": "POST",
              "headers": {
                  "Authorization": "Bearer " + $.cookie("ACCESS_TOKEN"),
                  "cache-control": "no-cache",
                  "Postman-Token": "0d83bfb4-ef46-46d6-ae5e-02b7a296a3e2"
              },
              "contentType": "application/json",
              "processData": false,
              "data": "{\n\t\"id\":"+$("#coreid").val()+"\n}"
          }

          $.ajax(settings).done(function (response) {

              var root=response.data[0].route_path.split("//")[1].split("/");
              root.forEach(function (value, index) {
                  $("#root").append("("+(index+1)+"级)"+value+">");
              })

              $("#level").val(response.data[0].level);
              $("#root").append(response.data[0].class_name+" | " +response.data[0].level+"级分类   ");
              //("#desc").append(response.data[0].class_desc);
          if(response.data[0].level==5){
              var settings = {
                  "async": true,
                  "crossDomain": true,
                  "url": "/brand/name?id="+response.data[0].brand_id,
                  "method": "GET",
                  "processData": false,
                  "headers": {
                      "Authorization": "Bearer " + $.cookie("ACCESS_TOKEN"),
                      "cache-control": "no-cache",
                      "Postman-Token": "0d83bfb4-ef46-46d6-ae5e-02b7a296a3e2"
                  }
              }


              $.ajax(settings).done(function (response) {
               $("#title").append("品牌："+response.data);
              });

              var settings = {
                  "async": true,
                  "crossDomain": true,
                  "url": "/file/workpdf?id="+response.data[0].id,
                  "method": "GET",
                  "processData": false,
                  "headers": {
                      "Authorization": "Bearer " + $.cookie("ACCESS_TOKEN"),
                      "cache-control": "no-cache",
                      "Postman-Token": "0d83bfb4-ef46-46d6-ae5e-02b7a296a3e2"
                  }
              }


              $.ajax(settings).done(function (response) {
                  $("#level5space").append(
                  "<object width=\"100%\" height=\"800px\" data=\""+response.data.basicurl+response.data.data[0].pdf_file+"\"> \n" +
                  "</object>");
              });





          }
              if(response.data[0].level==4||response.data[0].level==3){

                  var settings = {
                      "async": true,
                      "crossDomain": true,
                      "url": "/productclass/levellogo?id="+response.data[0].id,
                      "method": "GET",
                      "processData": false,
                      "headers": {
                          "Authorization": "Bearer " + $.cookie("ACCESS_TOKEN"),
                          "cache-control": "no-cache",
                          "Postman-Token": "0d83bfb4-ef46-46d6-ae5e-02b7a296a3e2"
                      }
                  }


                  $.ajax(settings).done(function (response) {
                      response.data.forEach(function (v,i) {
                          $("#level5space").append("<div class=\"col-lg-3 col-md-6 col-sm-12 mb-4\" onclick=\"putlogo('"+v.logo+"')\">\n" +
                              "                      <div class=\"card card-small card-post card-post--1\">\n" +
                              "                          <div class=\"card-post__image\" style=\"background-image: url('https://web-site-1252739071.cos.ap-shanghai.myqcloud.com/product_class/images/"+v.logo+"');\">\n" +
                              "                              <a href=\"#\" class=\"card-post__category badge badge-pill badge-warning\">"+v.class_name+"</a>\n" +
                              "                          </div>\n" +
                              // "                          <div class=\"card-body\">\n" +
                              // "                              <h5 class=\"card-title\">\n" +
                              // "                                  <a class=\"text-fiord-blue\" href=\"#\">It so numerous if he may outlived disposal</a>\n" +
                              // "                              </h5>\n" +
                              // "                              <p class=\"card-text d-inline-block mb-3\">How but sons mrs lady when. Her especially are unpleasant out alteration continuing unreserved ready road market resolution...</p>\n" +
                              // "                              <span class=\"text-muted\">29 February 2019</span>\n" +
                              // "                          </div>\n" +
                              "                      </div>\n" +
                              "                  </div>");
                      })
                  });
              }
          });
      }

      function putlogo(logo) {
          $("#mylogo").attr("src","https://web-site-1252739071.cos.ap-shanghai.myqcloud.com/product_class/images/"+logo);
          $("#mylogourl").val(logo);
      }

      function tg(id) {


              var settings = {
                  "async": true,
                  "crossDomain": true,
                  "url": "/basedata/tg?level="+ $("#level").val(),
                  "method": "GET",
                  "headers": {
                      "Authorization": "Bearer " + $.cookie("ACCESS_TOKEN"),
                      "cache-control": "no-cache",
                      "Postman-Token": "0d83bfb4-ef46-46d6-ae5e-02b7a296a3e2"
                  }
              }
              $.ajax(settings).done(function (response) {
                  self.location.href="/system/tasklogo?id="+response.data.data[0].taskno;

              });

      }

      function update() {
          if($("#mylogourl").val()==null||$("#mylogourl").val()==""){
              return;
          }
          var settings = {
              "async": true,
              "crossDomain": true,
              "url": "/basedata/updatetask?url="+$("#mylogourl").val()+"&id="+$("#coreid").val(),
              "method": "PUT",
              "headers": {
                  "Authorization": "Bearer " + $.cookie("ACCESS_TOKEN"),
                  "cache-control": "no-cache",
                  "Postman-Token": "0d83bfb4-ef46-46d6-ae5e-02b7a296a3e2"
              },
              "processData": false
          }



          $.ajax(settings).done(function (response) {
              console.log(response);
              var settings = {
                  "async": true,
                  "crossDomain": true,
                  "url": "/basedata/task?level="+ $("#level").val(),
                  "method": "GET",
                  "headers": {
                      "Authorization": "Bearer " + $.cookie("ACCESS_TOKEN"),
                      "cache-control": "no-cache",
                      "Postman-Token": "0d83bfb4-ef46-46d6-ae5e-02b7a296a3e2"
                  }
              }
              $.ajax(settings).done(function (response) {
                  // if (response.data.data.size()==0){
                  //     alert("没有任务了");
                  // }
                  self.location.href="/system/tasklogo?id="+response.data.data[0].taskno;

              });
          });
      }


      $("#imgfile").on("change",function(){
          function getObjectURL(file) {
              var url = null;
              if (window.createObjcectURL != undefined) {
                  url = window.createOjcectURL(file);
              } else if (window.URL != undefined) {
                  url = window.URL.createObjectURL(file);
              } else if (window.webkitURL != undefined) {
                  url = window.webkitURL.createObjectURL(file);
              }
              return url;
          }
          var blobURL = getObjectURL(this.files[0]);//这里的objURL就是input file的blob:路径
          var imgUTL = '';

          var xhr = new XMLHttpRequest();
          xhr.open('GET', blobURL);
          xhr.responseType = 'blob';

          xhr.onreadystatechange = function() {
              if (this.readyState === 4 && this.status === 200) {
                  var imageBlob = this.response;
                  var imageType = imageBlob.type;
                  var imageName = null;
// 根据文件的类型确定文件名，否则服务端得到的文件名为 blob，没有后缀
                  if (imageType.includes('png')) {
                      imageName = 'uploaded-image.png';
                  } else if (imageType.includes('gif')) {
                      imageName = 'uploaded-image.gif';
                  } else if (imageType.includes('bmp')) {
                      imageName = 'uploaded-image.bmp';
                  } else {
                      imageName = 'uploaded-image.jpg';
                  }
// 上传 Blob 图片
                  var form = new FormData();
                  form.append('file', imageBlob, imageName); // 第三个参数为文件名
                  $.ajax({
                      type: 'POST',
                      url : "/file/uploadLogo",
                      data: form ,
                      processData: false,
                      contentType: false,
                  }).done(function(result) {
// 把服务器返回的图片 URL 插入到需要的地方
                      console.log(result);
                      $("#mylogo").attr("src","https://web-site-1252739071.cos.ap-shanghai.myqcloud.com/product_class/images/"+result.data);
                      $("#mylogourl").val(result.data);
                  });
              }
          };
          xhr.send();
      })

      init();

      $("#myp").on('paste', function(eventObj) {
          // 处理粘贴事件
          var event = eventObj.originalEvent;
          var imageRe = new RegExp(/image\/.*/);
          var fileList = $.map(event.clipboardData.items, function (o) {
              if(!imageRe.test(o.type)){ return }
              var blob = o.getAsFile();
              return blob;
          });
          if(fileList.length <= 0){ return }
          upload(fileList);
          //阻止默认行为即不让剪贴板内容在div中显示出来
          event.preventDefault();
      });
      function upload(fileList) {
          for(var i = 0, l = fileList.length; i < l; i++){
              var fd = new FormData();
              var f = fileList[i];
              fd.append('file', f);
              $.ajax({
                  url:"/file/uploadLogo",
                  type: 'POST',
                  dataType: 'json',
                  data: fd,
                  processData: false,
                  contentType: false,
                  xhrFields: { withCredentials: true },
                  "headers": {
                      "Authorization": "Bearer " + $.cookie("ACCESS_TOKEN"),
                      "cache-control": "no-cache",
                      "Postman-Token": "0d83bfb4-ef46-46d6-ae5e-02b7a296a3e2"
                  },
                  success: function(result){
                          // var img = document.createElement('img');
                          // img.attr("src","https://web-site-1252739071.cos.ap-shanghai.myqcloud.com/product_class/images/"+res.data);
                          // editor.appendChild(img);
                      $("#mylogo").attr("src","https://web-site-1252739071.cos.ap-shanghai.myqcloud.com/product_class/images/"+result.data);
                      $("#mylogourl").val(result.data);
                  },
                  error: function(){
                      alert("上传图片错误");
                  }
              });
          }
      }


  </script>
  </body>
</html>